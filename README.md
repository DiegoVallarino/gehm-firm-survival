#  Project: GNN-Enhanced Survival Analysis for Firms

**Author:** Diego Vallarino, PhD  
**Last Updated:** September 2025  
**Languages:** Python (Embeddings), R (Survival Analysis)

---

##  Objective
This project combines Graph Neural Networks (GNNs) with survival analysis to model and predict the probability of firm exit over time. The embeddings generated by the GNN are used as input to Cox proportional hazards models in R, capturing network-level dependencies that enrich traditional firm-level covariates.

The repository supports the academic paper:
**"When Firms Fail to Adopt: Network-Mediated Survival under AI and General-Purpose Technologies"**  
(Diego Vallarino, 2025)

---

##  Folder Structure
```text
GraphSurvival-AI/
├── README.md                       # This file
├── LICENSE                         # License terms (MIT or CC-BY-NC)
├── data/
│   ├── firms_features.csv          # Raw firm data for embedding generation
│   └── firms_survival_full.csv     # Panel with survival outcomes + embeddings
│
├── python/
│   └── gnn_embeddings.py           # Script to generate GNN-based embeddings
│
├── R/
│   └── survival_analysis.R         # R script for Kaplan-Meier and Cox analysis
│
├── output/
│   ├── firm_embeddings_gnn.csv     # Resulting node embeddings
│   └── figures/                    # (Optional) Survival plots, PCA, etc.
│
├── docs/
│   ├── Extra_Material.pdf          # Computational appendix (uploaded)
│   └── figures/                    # (Optional) Figures used in publication
```

---

##  Step-by-Step Instructions

### 1. Python: Generate GNN Embeddings

**Install dependencies**:
```bash
pip install torch torch-geometric pandas networkx
```

**Run the script**:
```bash
cd python
python gnn_embeddings.py
```
This will output a file `firm_embeddings_gnn.csv` into `output/`, containing 4-dimensional structural embeddings per firm.

---

### 2. R: Survival Analysis

**Install required R packages**:
```r
install.packages(c("survival", "survminer", "dplyr", "FactoMineR", "factoextra", "corrplot"))
```

**Run the analysis**:
```r
setwd("R")
source("survival_analysis.R")
```

This script performs:
- Kaplan-Meier estimation by Sector and Region
- Cox proportional hazards models:
  - Model A: Covariates only
  - Model B: Covariates + Embeddings
  - Model C: Embeddings only
- Correlation and PCA analysis of embeddings
- Exports plots into `output/figures/`

---

##  Data Description

### firms_features.csv
| Column          | Description                           |
|----------------|---------------------------------------|
| Firm_ID        | Unique identifier for each firm       |
| Sector         | Categorical: industry sector          |
| Region         | Categorical: geographic region        |
| Size           | Numeric: firm size indicator          |
| Leverage       | Numeric: debt ratio                   |
| Profit_Margin  | Numeric: profitability measure        |
| Org_Complexity | Numeric: number of branches, etc.     |
| RD_Intensity   | Numeric: R&D investment ratio         |

### firms_survival_full.csv
Same as above, but includes:
- `Event_Time`: Duration until exit or censoring
- `Status`: 1 = exited, 0 = censored
- `Embed_1` to `Embed_4`: GNN-based node embeddings

---

##  Model Summary

###  GNN (Graph Convolutional Network)
- **Library:** PyTorch Geometric
- **Input:** Encoded firm features
- **Graph:** Edges based on shared Sector and Region
- **Architecture:** 2-layer GCN with ReLU
- **Loss:** Self-supervised embedding training
- **Output:** 4-dimensional vector per firm

###  Survival Models (R)
- **KM Curves:** Overall, by Region, by Sector
- **Cox Models:** Compare baseline model with GNN-enhanced variants

---

##  Outputs

- `firm_embeddings_gnn.csv`: GNN node embeddings
- `KM_curves_sector.pdf`, `KM_curves_region.pdf`
- `correlation_plot.png`, `pca_plot.png`
- R console output with hazard ratios and p-values

---

##  License & Citation

Use of this repository is granted for **academic purposes only**. Please cite:
```bibtex
@article{Vallarino2025,
  title={When Firms Fail to Adopt: Network-Mediated Survival under AI and General-Purpose Technologies},
  author={Vallarino, Diego},
  journal={Working Paper},
  year={2025}
}
```

---

## ✉️ Contact
For access to the private GitHub repository, real data, or further replication files, contact: **diegoval@iadb.org**

---

## Disclaimer
This repository uses **synthetic data** generated for methodological illustration only. Results do not represent real firms or behaviors. Users intending to replicate the pipeline with real data should replace `data/` inputs accordingly and comply with all ethical and legal data access conditions.

---
