#  Project: GNN-Enhanced Survival Analysis for Firms

**Author:** Diego Vallarino, PhD  
**Last Updated:** September 2025  
**Languages:** Python (Embeddings), R (Survival Analysis)

---

##  Objective
This project combines Graph Neural Networks (GNNs) with survival analysis to model and predict the probability of firm exit over time. The embeddings generated by the GNN are used as input to Cox proportional hazards models in R, capturing network-level dependencies that enrich traditional firm-level covariates.

The repository supports the academic paper:
**"When Firms Fail to Adopt: Network-Mediated Survival under AI and General-Purpose Technologies"**  
(Diego Vallarino, 2025)

---

##  Folder Structure
```text
GraphSurvival-AI/
â”œâ”€â”€ README.md                       # This file
â”œâ”€â”€ LICENSE                         # License terms (MIT or CC-BY-NC)
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ firms_features_clean.csv          # Raw firm data for embedding generation
â”‚   â””â”€â”€ firms_survival_full_clean.csv     # Panel with survival outcomes + embeddings
â”‚
â”œâ”€â”€ python/
â”‚   â””â”€â”€ gnn_embeddings.py           # Script to generate GNN-based embeddings
â”‚
â”œâ”€â”€ R/
â”‚   â””â”€â”€ survival_analysis.R         # R script for Kaplan-Meier and Cox analysis
â”‚
â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ firm_embeddings_gnn.csv     # Resulting node embeddings
â”‚   â””â”€â”€ figures/                    # (Optional) Survival plots, PCA, etc.
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ Extra_Material.pdf          # Computational appendix (uploaded)
â”‚   â””â”€â”€ figures/                    # (Optional) Figures used in publication
```

---

##  Step-by-Step Instructions

### 1. Python: Generate GNN Embeddings

**Install dependencies**:
```bash
pip install torch torch-geometric pandas networkx
```

**Run the script**:
```bash
cd python
python gnn_embeddings.py
```
This will output a file `firm_embeddings_gnn.csv` into `output/`, containing 4-dimensional structural embeddings per firm.

---

### 2. R: Survival Analysis

**Install required R packages**:
```r
install.packages(c("survival", "survminer", "dplyr", "FactoMineR", "factoextra", "corrplot"))
```

**Run the analysis**:
```r
setwd("R")
source("survival_analysis.R")
```

This script performs:
- Kaplan-Meier estimation by Sector and Region
- Cox proportional hazards models:
  - Model A: Covariates only
  - Model B: Covariates + Embeddings
  - Model C: Embeddings only
- Correlation and PCA analysis of embeddings
- Exports plots into `output/figures/`

---

##  Data Description

### firms_features_clean.csv
| Column          | Description                           |
|----------------|---------------------------------------|
| Firm_ID        | Unique identifier for each firm       |
| Sector         | Categorical: industry sector          |
| Region         | Categorical: geographic region        |
| Size           | Numeric: firm size indicator          |
| Leverage       | Numeric: debt ratio                   |
| Profit_Margin  | Numeric: profitability measure        |
| Org_Complexity | Numeric: number of branches, etc.     |
| RD_Intensity   | Numeric: R&D investment ratio         |
| Event_Time     | Duration until exit or censoring      |
| Status         | 1 = exited, 0 = censored              |

### firms_survival_full_clean.csv
Same as above, but includes:
- `Embed_1` to `Embed_4`: GNN-based node embeddings

---

##  Synthetic Data Generation with GAN

To construct the synthetic dataset used in this project, we implemented a **Generative Adversarial Network (GAN)** in PyTorch.  
The GAN learns the joint distribution of firm-level features from the original dataset (`real_data.csv`) and generates a synthetic dataset (`firms_features_clean.csv`) that preserves key statistical properties while ensuring confidentiality.

The training loop alternates between a **Generator**, which creates synthetic firm data from random noise, and a **Discriminator**, which distinguishes between real and synthetic samples. After training, the generator is used to produce a full synthetic dataset of firms.

You can find the reference implementation here:  
**[`Data Sintetica GAN.py`](Data%20Sintetica%20GAN.py)** .

---

##  Validation of Synthetic vs Real Data

To assess the quality of the synthetic dataset (`firms_features_clean.csv`), we compare descriptive statistics, distributions, and correlation structures against the real dataset (`real_data.csv`).

### ðŸ“Š Descriptive Statistics Comparison
<img width="527" height="542" alt="1" src="https://github.com/user-attachments/assets/ec3c079a-35cc-493d-b5e8-86fa3da9dd5b" />


###  Correlation Structures (Real vs Synthetic)
<img width="1047" height="585" alt="image" src="https://github.com/user-attachments/assets/e7d4b5e0-2144-444a-8196-2d368d5831cf" />



The evaluation highlights deviations between real and synthetic data, with an average absolute correlation difference of **0.189** and significant KS/Wasserstein statistics for key features. These diagnostics underscore the importance of iterative GAN tuning to enhance the fidelity and utility of the synthetic dataset.


---

##  Model Summary

###  GNN (Graph Convolutional Network)
- **Library:** PyTorch Geometric
- **Input:** Encoded firm features
- **Graph:** Edges based on shared Sector and Region
- **Architecture:** 2-layer GCN with ReLU
- **Loss:** Self-supervised embedding training
- **Output:** 4-dimensional vector per firm

###  Survival Models (R)
- **KM Curves:** Overall, by Region, by Sector
- **Cox Models:** Compare baseline model with GNN-enhanced variants

---

##  Outputs

- `firm_embeddings_gnn.csv`: GNN node embeddings
- `KM_curves_sector.pdf`, `KM_curves_region.pdf`
- `correlation_plot.png`, `pca_plot.png`
- R console output with hazard ratios and p-values

---

##  License & Citation

Use of this repository is granted for **academic purposes only**. Please cite:
```bibtex
@article{Vallarino2025,
  title={When Firms Fail to Adopt: Network-Mediated Survival under AI and General-Purpose Technologies},
  author={Vallarino, Diego},
  journal={Working Paper},
  year={2025}
}
```

---

## Contact
For access to the private GitHub repository, real data, or further replication files, contact: **diegoval@iadb.org**

---


